:root {
	/* Light Theme (Default) */
	--bg-color: #fdfdfd;
	--tab-bar-bg: #f0f0f0;
	--tab-bg: #e0e0e0;
	--tab-hover-bg: #d4d4d4;
	--tab-active-bg: #ffffff;
	--text-color: #333333;
	--text-secondary: #555555;
	--text-muted: #888888;

	--accent-color: #00bcd4;
	--split-color: #ff9800;
	--border-color: #cccccc;

	--card-bg: #ffffff;
	--card-hover-bg: #f5f5f5;
	--card-border: #dddddd;
	--card-disabled-opacity: 0.6;

	--input-bg: #ffffff;
	--input-border: #cccccc;
	--input-disabled-bg: #eeeeee;

	--modal-bg: #ffffff;
	--modal-overlay: rgba(0, 0, 0, 0.4);

	--hover-highlight: rgba(0, 0, 0, 0.05);

	--tab-height: 40px;
}

@media (prefers-color-scheme: dark) {
	:root {
		/* Dark Theme */
		--bg-color: #202020;
		--tab-bar-bg: #2d2d2d;
		--tab-bg: #383838;
		--tab-hover-bg: #454545;
		--tab-active-bg: #505050;
		--text-color: #e0e0e0;
		--text-secondary: #bbbbbb;
		--text-muted: #888888;

		--border-color: #1a1a1a;

		--card-bg: #2d2d2d;
		--card-hover-bg: #383838;
		--card-border: #444444;

		--input-bg: #333333;
		--input-border: #555555;
		--input-disabled-bg: #2a2a2a;

		--modal-bg: #2d2d2d;
		--modal-overlay: rgba(0, 0, 0, 0.6);

		--hover-highlight: rgba(255, 255, 255, 0.1);
	}
}

body {
	background-color: var(--bg-color);

	margin: 0;
	padding: 0;
	font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
	overflow: hidden;
	color: var(--text-color);
}

#app-container {
	display: flex;
	flex-direction: column;
	height: 100vh;
}

#tabarea {
	height: var(--tab-height);
	background-color: var(--tab-bar-bg);
	display: flex;
	align-items: center;
	border-bottom: 1px solid var(--border-color);
	user-select: none;
	padding: 0 10px;
	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
	z-index: 100;
}

#tabs-container {
	display: flex;
	flex-grow: 1;
	overflow-x: auto;
	overflow-y: hidden;
	align-items: center;
	height: 100%;
	scrollbar-width: none; /* Firefox */
}

#tabs-container::-webkit-scrollbar {
	display: none; /* Chrome/Safari */
}

#tabs {
	display: flex;
	height: 100%;
	align-items: flex-end; /* Align tabs to bottom of bar */
}

.tab {
	display: flex;
	align-items: center;
	justify-content: space-between;
	width: 180px;
	min-width: 120px;
	height: 32px; /* Slightly shorter than bar */
	background-color: var(--tab-bg);
	margin-right: 2px;
	padding: 0 10px;
	border-radius: 8px 8px 0 0;
	cursor: pointer;
	transition:
		background-color 0.2s,
		min-width 0.2s;
	font-size: 0.9rem;
	position: relative;
	color: #aaa;
}

.tab:hover {
	background-color: var(--tab-hover-bg);
	color: #fff;
}

.tab.active {
	background-color: var(--tab-active-bg);
	color: #fff;
	box-shadow: 0 -2px 0 var(--accent-color) inset; /* Bottom accent line */
	height: 36px; /* Pop up slightly */
}

/* Split Target Style */
.tab.split-target {
	box-shadow: 0 -2px 0 var(--split-color) inset;
	background-color: #3e3e3e; /* Slightly different bg */
}

.tab.dragging {
	opacity: 0.5;
}

.tab .name {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	flex-grow: 1;
	pointer-events: none; /* Let click pass to tab */
}

.tab .close {
	width: 20px;
	height: 20px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	margin-left: 8px;
	font-size: 16px;
	line-height: 1;
	color: #aaa;
	opacity: 0.7;
	transition:
		opacity 0.2s,
		background-color 0.2s;
}

.tab .close:hover {
	opacity: 1;
	background-color: rgba(255, 255, 255, 0.2);
	color: #fff;
}

#tabadd {
	margin-left: 5px;
	display: flex;
	align-items: center;
}

#tabaddbtn {
	width: 28px;
	height: 28px;
	background-color: transparent;
	border: none;
	color: #aaa;
	font-size: 24px;
	cursor: pointer;
	border-radius: 4px;
	display: flex;
	align-items: center;
	justify-content: center;
	transition:
		background-color 0.2s,
		color 0.2s;
}

#tabaddbtn:hover {
	background-color: rgba(255, 255, 255, 0.1);
	color: #fff;
}

#controls {
	display: flex;
	align-items: center;
	padding-left: 10px;
	border-left: 1px solid var(--border-color);
	margin-left: 10px;
}

.control-btn {
	background: none;
	border: none;
	color: #aaa;
	cursor: pointer;
	padding: 5px;
	border-radius: 4px;
	transition:
		color 0.2s,
		background-color 0.2s;
}

.control-btn:hover,
.control-btn.active {
	color: var(--accent-color);
	background-color: rgba(0, 188, 212, 0.1);
}

#gamearea {
	flex-grow: 1;
	position: relative;
	display: flex; /* For split view */
	background-color: #000;
}

#gamearea iframe {
	width: 100%;
	height: 100%;
	border: none;
	flex-grow: 1;
}

/* Split View Styles */
.split-view #gamearea iframe {
	width: 50%;
	border-right: 1px solid var(--border-color);
}

.split-view #gamearea iframe:last-child {
	border-right: none;
}

#gamearea_cover {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	z-index: 1000; /* Ensure high enough */
	background: transparent;
	pointer-events: none; /* Changed via JS/Style when blocking */
	display: none;
}

#gamearea_cover[style*="block"] {
	pointer-events: auto;
}

#gamearea_cover.drag-over-left {
	background-color: rgba(0, 0, 0, 0.4);
}
#gamearea_cover.drag-over-left::before {
	content: "左側に分割表示";
	position: absolute;
	top: 0;
	left: 0;
	width: 50%;
	height: 100%;
	background-color: color-mix(in srgb, var(--accent-color), transparent 70%);
	border: 2px dashed var(--accent-color);
	box-sizing: border-box;
	display: flex;
	align-items: center;
	justify-content: center;
	color: white;
	font-size: 1.5rem;
	font-weight: bold;
	text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

/* Right Half Highlight */
#gamearea_cover.drag-over-right {
	background-color: rgba(0, 0, 0, 0.4);
}
#gamearea_cover.drag-over-right::after {
	content: "右側に分割表示";
	position: absolute;
	top: 0;
	right: 0;
	width: 50%;
	height: 100%;
	background-color: color-mix(in srgb, var(--split-color), transparent 70%);
	border: 2px dashed var(--split-color);
	box-sizing: border-box;
	display: flex;
	align-items: center;
	justify-content: center;
	color: white;
	font-size: 1.5rem;
	font-weight: bold;
	text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

/* Modal Styles */
.modal {
	position: fixed;
	z-index: 2000;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: var(--modal-overlay);
	backdrop-filter: blur(2px);
	display: flex;
	align-items: center;
	justify-content: center;
}

.modal-content {
	background-color: var(--modal-bg);
	margin: auto;
	padding: 0;
	border: 1px solid var(--card-border);
	width: 400px;
	max-width: 90%;
	border-radius: 8px;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
	animation: modal-pop 0.2s ease-out;
}

@keyframes modal-pop {
	from {
		transform: scale(0.9);
		opacity: 0;
	}
	to {
		transform: scale(1);
		opacity: 1;
	}
}

.modal-header {
	padding: 15px 20px;
	border-bottom: 1px solid var(--border-color);
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.modal-header h3 {
	margin: 0;
	font-size: 1.1rem;
	color: var(--text-color);
}

.close-modal {
	color: #aaa;
	float: right;
	font-size: 28px;
	font-weight: bold;
	cursor: pointer;
	line-height: 20px;
}

.close-modal:hover,
.close-modal:focus {
	color: #fff;
	text-decoration: none;
	cursor: pointer;
}

.modal-body {
	padding: 10px 0;
	max-height: 400px;
	overflow-y: auto;
}

.split-list-item {
	padding: 15px 20px;
	cursor: pointer;
	transition: background-color 0.1s;
	display: flex;
	align-items: center;
	color: #eee;
}

.split-list-item:hover {
	background-color: var(--hover-highlight);
}

.split-list-item .tab-icon {
	width: 20px;
	height: 20px;
	background-color: var(--text-secondary);
	border-radius: 50%;
	margin-right: 15px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 12px;
}

#view-mode-select {
	background-color: var(--bg-color);
	color: var(--text-color);
	width: 100%;
	height: 100%;
	position: fixed;
	top: 0;
	left: 0;
	z-index: 1000;
	overflow-y: auto;
	font-family: "Segoe UI", sans-serif;
	display: block; /* Changed from flex */
}

.mode-select-container {
	width: 100%;
	max-width: 700px;
	margin: 0 auto; /* Center with auto margin */
	padding: 40px 20px;
	box-sizing: border-box; /* Prevent overflow */
	display: flex;
	flex-direction: column;
	gap: 30px;
}

.app-title {
	font-size: 2.5rem;
	font-weight: 200;
	margin: 0;
	text-align: center;
	letter-spacing: 2px;
	color: var(--accent-color);
}

.app-subtitle {
	margin: -25px 0 20px;
	text-align: center;
	color: var(--text-muted);
	font-size: 0.9rem;
	letter-spacing: 1px;
}

.setting-section h2 {
	font-size: 1.1rem;
	margin: 0;
	color: var(--text-secondary);
	/* border-bottom: 1px solid #333; */ /* Removed border for better layout with buttons */
	/* padding-bottom: 5px; */
}

.selection-group {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
	gap: 15px;
}

.addon-grid {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
	gap: 10px;
}

/* Card Style for Radios and Checkboxes */
.radio-card,
.checkbox-card {
	background-color: var(--card-bg);
	border: 1px solid var(--card-border);
	border-radius: 8px;
	padding: 15px;
	cursor: pointer;
	display: flex;
	align-items: flex-start;
	transition: all 0.2s ease;
	position: relative;
	user-select: none;
}

.radio-card:hover,
.checkbox-card:hover {
	background-color: var(--card-hover-bg);
	border-color: var(--text-secondary);
}

/* Checked State - utilizing :has() if supported, or JS class toggling fallback */
.radio-card:has(input:checked),
.checkbox-card.checked,
/* Fallback for browsers without :has support, relies on input:checked + styling or JS */
	.radio-card input:checked
	+ .card-content {
	/* This specific rule isn't enough for the parent, handled by :has or JS mostly */
}

/* Because we can't reliably style parent without :has in older Electron? 
   No, Electron 28 supports :has. It's safe. */
.radio-card:has(input:checked),
.checkbox-card:has(input:checked) {
	background-color: rgba(0, 188, 212, 0.1);
	border-color: var(--accent-color);
	box-shadow: 0 0 0 1px var(--accent-color) inset;
}

.radio-card.disabled,
.checkbox-card.disabled {
	opacity: 0.5;
	cursor: default;
}
.radio-card.disabled:hover,
.checkbox-card.disabled:hover {
	background-color: var(--card-bg);
	border-color: var(--card-border);
}

/* Hide default inputs but keep them accessible */
.radio-card input,
.checkbox-card input {
	/* margin-right: 10px; */
	/* Instead of hiding completely, make them small or styled, 
       but for this design we might want to keep standard controls inside the card or hide them.
       Let's keep them visible but styled minimally or just rely on card highlight. */
	accent-color: var(--accent-color);
	margin-top: 3px;
	margin-right: 10px;
}

.card-content {
	display: flex;
	flex-direction: column;
}

.card-title {
	font-weight: bold;
	font-size: 1rem;
	color: var(--text-color);
}

.card-desc {
	font-size: 0.8rem;
	color: var(--text-muted);
	margin-top: 4px;
}

/* Animations */
.fade-in {
	animation: fadeIn 0.3s ease-in-out;
}
@keyframes fadeIn {
	from {
		opacity: 0;
		transform: translateY(-5px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Inputs & Buttons */
.input-group {
	display: flex;
	align-items: center;
	gap: 15px;
	margin-bottom: 10px;
}

.styled-select {
	background-color: var(--input-bg);
	color: var(--text-color);
	border: 1px solid var(--input-border);
	padding: 8px 15px;
	border-radius: 4px;
	font-size: 1rem;
	cursor: pointer;
}
.styled-select:focus {
	outline: none;
	border-color: var(--accent-color);
}

.notice-box {
	background-color: var(--input-bg);
	color: var(--text-muted);
	padding: 15px;
	border-radius: 4px;
	font-style: italic;
	text-align: center;
	border: 1px solid var(--border-color);
}

.action-area {
	margin-top: 20px;
	display: flex;
	justify-content: center;
}

.start-btn {
	background: linear-gradient(135deg, var(--accent-color), #0097a7);
	color: white;
	font-size: 1.2rem;
	padding: 12px 60px;
	border: none;
	border-radius: 50px;
	cursor: pointer;
	box-shadow: 0 4px 15px rgba(0, 188, 212, 0.4);
	transition:
		transform 0.2s,
		box-shadow 0.2s;
	font-weight: bold;
	letter-spacing: 1px;
}

.start-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(0, 188, 212, 0.6);
}
.start-btn:active {
	transform: translateY(1px);
	box-shadow: 0 2px 10px rgba(0, 188, 212, 0.4);
}

/* Window Mode specific styles */
#view-window-mode {
	width: 100vw;
	height: 100vh;
	background-color: var(--bg-color);
}
#gamearea-window {
	width: calc(100vw - 5px);
	height: calc(100dvh - 5px);
	display: grid;
	gap: 0;
	margin: 0;
	padding: 0;
}
#gamearea-window iframe {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 100%;
	height: 100%;
	border: none;
}

.styled-input {
	background-color: var(--input-bg);
	color: var(--text-color);
	border: 1px solid var(--input-border);
	padding: 8px 15px;
	border-radius: 4px;
	font-size: 1rem;
	flex-grow: 1;
}
.styled-input:focus {
	outline: none;
	border-color: var(--accent-color);
}
.styled-input:disabled {
	background-color: var(--input-disabled-bg);
	color: var(--text-secondary);
	border-color: var(--input-border);
}

.secondary-btn {
	background-color: transparent;
	border: 1px solid var(--input-border);
	color: var(--text-secondary);
	padding: 8px 15px;
	border-radius: 4px;
	cursor: pointer;
	transition: all 0.2s;
}
.secondary-btn:hover:not(:disabled) {
	border-color: var(--accent-color);
	color: var(--accent-color);
	background-color: rgba(0, 188, 212, 0.1);
}
.secondary-btn:disabled {
	opacity: 0.5;
	cursor: default;
}

.test-result {
	margin-top: 10px;
	font-size: 0.9rem;
	height: 1.2rem;
}
.test-success {
	color: #4caf50;
}
.test-error {
	color: #f44336;
}
.test-loading {
	color: var(--text-muted);
}
